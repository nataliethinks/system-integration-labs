upstream flask_app {
    # When both containers share a Docker network, use the container name:
    server flask-cloud:5000;
    # If testing with only the Flask container and NGINX on the host,
    # comment the line above and uncomment one of the following:
    # server host.docker.internal:5000;   # macOS/Windows Docker Desktop
    # server 172.17.0.1:5000;             # typical Linux host IP for Docker
}

server {
    listen 80;
    server_name _;

    # Health of the gateway itself
    location = / {
        return 200 'API Gateway up';
        add_header Content-Type text/plain;
    }

    # Forward /api/* to the Flask app (strip the /api/ prefix)
    location /api/ {
        proxy_pass http://flask_app/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
